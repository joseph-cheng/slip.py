<script type="text/javascript">
  function checkSubmit(e) {
     if(e && e.keyCode == 13) {
        document.forms[0].submit();
     }
  }
  function setPlayer(me,pnum) {
    var cid   = $(me).data('cid');
    var cname = $(me).data('cname');
    var imurl = "{{ url_for('static',filename='icons/stock') }}/"+cname+"0.png"
    $("#b-p"+pnum).prop('title',cname);
    $("#b-p"+pnum).html("<img src='"+imurl+"'/>");
    $("#b-p"+pnum).addClass("noarrow");
    $("#s-p"+pnum+"-char").val(cid);
  }
  function setStage(me) {
    var sid   = $(me).data('sid');
    var sname = $(me).data('sname');
    var imurl = "{{ url_for('static',filename='icons/stage') }}/"+sname+".png"
    $("#b-stage").html("<img src='"+imurl+"'/>");
    $("#b-stage").prop('title',sname);
    $("#b-stage").addClass("noarrow");
    $("#s-stage").val(sid);
  }
  function setSort(me) {
    var sid   = $(me).data('sid');
    var sname = $(me).data('sname');
    $("#b-sort").html(sname);
    $("#s-sort").val(sid);
  }
</script>

{# <div onKeyPress="return checkSubmit(event)"/> #}
<span id="replaySearchBar">
  <form id="searchForm" name="searchForm" action="" method="get" novalidate autocomplete="off">
      {# {{ form.hidden_tag() }} #}
      {{ form.query(class="placeholderLabel") }}
      <span class="dropdown-wrapper hideUntilParentClicked">
        <button id="b-p1" type='button' class="has-dropdown">P1</button>
        <span class="dropdown css-dropdown">{% for c in chardata %}
          <img title="{{ c.name }}" data-cid="{{ c.id }}" data-cname="{{ c.intname }}" onclick="setPlayer(this,1)" src="{{ url_for('static',filename='icons/stock') }}/{{ c.intname }}0.png"/>
        {% endfor %}</span>
      </span>

      <span class="dropdown-wrapper hideUntilParentClicked">
        <button id="b-stage"    type='button' class="has-dropdown">Stage</button>
        <span class="dropdown stage-dropdown">{% for s in stagedata[:6] %}
          <img title="{{ s.name }}" data-sid="{{ s.id }}" data-sname="{{ s.intname }}" onclick="setStage(this)" src="{{ url_for('static',filename='icons/stage') }}/{{ s.intname }}.png"/>
        {% endfor %}</span>
      </span>

      <span class="dropdown-wrapper hideUntilParentClicked">
        <button id="b-p2"    type='button' class="has-dropdown">P2</button>
        <span class="dropdown css-dropdown">{% for c in chardata %}
          <img title="{{ c.name }}" data-cid="{{ c.id }}" data-cname="{{ c.intname }}" onclick="setPlayer(this,2)" src="{{ url_for('static',filename='icons/stock') }}/{{ c.intname }}0.png"/>
        {% endfor %}</span>
      </span>

      <span class="dropdown-wrapper hideUntilParentClicked">
        <button id="b-sort"  type='button' class="has-dropdown">Recently Uploaded</button>
        <span class="dropdown sort-dropdown">{% for s in sortdata %}
          <span data-sid="{{ s.intname }}" data-sname="{{ s.name }}" onclick="setSort(this)">{{ s.name }}</span>
        {% endfor %}</span>
      </span>

      {{ form.p1char() }}
      {{ form.p2char() }}
      {{ form.stage() }}
      {{ form.sort() }}
      {{ form.submit(class="hideUntilParentClicked") }}
  </form>
</span>

<script type="text/javascript">
$("#replaySearchBar").click(function() {
  $("#s-query").attr("placeholder", "Enter search terms...").removeClass("placeholderLabel");
  $(".hideUntilParentClicked").addClass("unhiding");
  $("#searchForm").addClass("clicked");
  setTimeout(function(){
    $(".hideUntilParentClicked").addClass("noLongerHidden").css('opacity');
  }, 100);
});
</script>
