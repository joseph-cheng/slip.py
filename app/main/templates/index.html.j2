{% extends "header.html.j2" %}

{% block content %}
  <span id="replayListingGrid">
    {% if prev_url %}
      <a id="prev-a" class="nostyle" href="{{ prev_url }}"><button id="prev" type="button">&lt;</button></a>
    {% else %}
      <button id="prev" type="button" disabled>&lt;</button>
    {% endif %}
    {% if next_url %}
      <a id="next-a" class="nostyle" href="{{ next_url }}"><button id="next" type="button">&gt;</button></a>
    {% else %}
      <button id="next" type="button" disabled>&gt;</button>
    {% endif %}
    {% if form %}
      {% include '_search-bar.html.j2' %}
    {% endif %}
    <span id="replayListingInnerGrid">
      {% for dsummary in dirs %}
        <span class="hoverWrapper">
          <span class="dirSummary" onclick='travel("{{dsummary.path}}")'>
            <span class="dsIcon"><img src="{{ url_for('static',filename='icons/folder-white.svg')}}"></img></span>
            <span class="dsTitle">{{dsummary.name}}</span>
            <span class="dsSubs">{{dsummary.dirs}} subfolder(s)</span>
            <span class="dsReplays">{{dsummary.files}} replay(s)</span>
          </span>
        </span>
      {% endfor %}
      <div></div>
      {% for rsummary in replays %}
        <span class="hoverWrapper">
          {% include '_replay-mini.html.j2' %}
        </span>
      {% endfor %}
    </span>
  </span>

  <script type="text/javascript">
    function travel(path) {
      location.href = URL_add_parameter(location.href,"path",path);
    }
    // https://stackoverflow.com/questions/5997450/append-to-url-and-refresh-page
    function URL_add_parameter(url, param, value){
        var hash       = {};
        var parser     = document.createElement('a');

        parser.href    = url;

        var parameters = parser.search.split(/\?|&/);

        for(var i=0; i < parameters.length; i++) {
            if(!parameters[i])
                continue;

            var ary      = parameters[i].split('=');
            hash[ary[0]] = ary[1];
        }

        hash[param] = value;

        var list = [];
        Object.keys(hash).forEach(function (key) {
            list.push(key + '=' + hash[key]);
        });

        parser.search = '?' + list.join('&');
        return parser.href;
    }
  </script>
{% endblock %}
